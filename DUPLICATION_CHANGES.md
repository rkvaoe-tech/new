# Изменения в логике дублирования офферов

## Проблема
При дублировании карточки оффера не копировались связанные лендинги и прелендинги.

## Решение
Создан новый API endpoint и обновлена логика дублирования для включения всех связанных данных.

## Внесенные изменения

### 1. Новый API endpoint
**Файл:** `src/app/api/offers/[id]/duplicate/route.ts`
- Создан специализированный endpoint для дублирования офферов
- Использует транзакцию базы данных для атомарности операций
- Копирует все лендинги и прелендинги с сохранением их свойств
- Ведет детальное аудит-логирование

### 2. Обновление компонентов
**Файлы:**
- `src/components/offers/offer-card.tsx` - уже использовал правильный endpoint
- `src/components/offers/sortable-offer-card.tsx` - обновлен для использования нового endpoint

### 3. Расширение системы аудита
**Файл:** `src/lib/audit.ts`
- Добавлена поддержка действия "duplicate"
- Добавлена поддержка метаданных для детального логирования

## Результат
Теперь при нажатии кнопки "Дублировать" в интерфейсе:
- ✅ Создается копия оффера с названием "(копия)"
- ✅ Копируются все лендинги с их свойствами
- ✅ Копируются все прелендинги с их свойствами
- ✅ Новый оффер создается в статусе "PAUSED"
- ✅ Сохраняется порядок лендингов
- ✅ Ведется полное аудит-логирование

## Технические детали
- Используется транзакция Prisma для атомарности операций
- Сохраняются все свойства лендингов: URL, локаль, партнерский код, заметки, порядок
- Новый оффер размещается в начале списка (минимальный order)
- Операция безопасна и откатывается при любой ошибке
